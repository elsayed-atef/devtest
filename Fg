param (
    [string]$WildcardPath = "C:\temp\logs\*\fgh"
)

function Expand-WildcardPath {
    param (
        [string]$WildcardPath
    )

    $WildcardPathParts = $WildcardPath -split '\\'
    $ExpandedPaths = @('')

    foreach ($part in $WildcardPathParts) {
        if ($part -eq '*') {
            $NewPaths = @()
            foreach ($basePath in $ExpandedPaths) {
                $dirs = Get-ChildItem -Path $basePath -Directory | ForEach-Object { $_.FullName }
                $NewPaths += $dirs
            }
            $ExpandedPaths = $NewPaths
        } else {
            $ExpandedPaths = $ExpandedPaths | ForEach-Object {
                Join-Path -Path $_ -ChildPath $part
            }
        }

        # Debugging: Display the current expanded paths after each step
        Write-Host "DEBUG: Expanded paths so far: $ExpandedPaths"
    }

    return $ExpandedPaths | Where-Object { Test-Path $_ }
}

# Expand the wildcard path and output the results
$ExpandedPaths = Expand-WildcardPath -WildcardPath $WildcardPath

# Debugging: Output expanded paths
if ($ExpandedPaths.Count -eq 0) {
    Write-Host "DEBUG: No paths were expanded."
} else {
    foreach ($path in $ExpandedPaths) {
        Write-Host "DEBUG: Expanded path: $path"
    }
}

# Output expanded paths
$ExpandedPaths
